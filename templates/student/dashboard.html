{% extends "base.html" %} {% load static %} {% if not user.is_authenticated %}
{% url 'login' as login %}
<script>
  window.location.href = "{{ login }}?next={{ request.path|urlencode }}";
</script>
{% else %} {% block title %}Student Dashboard - WachemoSaPS{% endblock %} 
{% block content %}



<div class="max-w-7xl mx-auto px-4 py-6 grid grid-cols-1 md:grid-cols-[16rem_1fr] gap-6">
  <!-- Sidebar -->
  {% include "student/sidebar.html" %}
  <!-- Main Content -->
  <main>
    <!-- Dashboard Home -->
    <div id="section-dashboard" class="space-y-6">
      <div class="text-center">
        <h2 class="text-2xl font-semibold">Welcome to Your Dashboard</h2>
        <p class="text-gray-600">Stay updated with your courses, grades, and school news.</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-blue-50 border border-blue-200 text-blue-800 rounded p-4">
          <strong>Tip:</strong> Check your assignments regularly to stay on top of deadlines!
        </div>
        <div class="bg-green-50 border border-green-200 text-green-800 rounded p-4">
          <strong>Upcoming Event:</strong> School Science Fair on <span class="font-semibold">June 15</span>. Donâ€™t miss it!
        </div>
      </div>
      <!-- Quick Stats Cards -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-blue-600 text-white rounded p-4 text-center">
          <div class="text-2xl mb-1"><i class="fas fa-book"></i></div>
          <h5 class="font-semibold">My Courses</h5>
          <h3 class="text-2xl font-bold">{{ courses|length }}</h3>
          <small>Enrolled</small>
        </div>
        <div class="bg-green-600 text-white rounded p-4 text-center">
          <div class="text-2xl mb-1"><i class="fas fa-tasks"></i></div>
          <h5 class="font-semibold">Assignments</h5>
          <h3 class="text-2xl font-bold">{{ upcoming_assignments|length }}</h3>
          <small>Due Assignments</small>
        </div>
        <div class="bg-yellow-500 text-white rounded p-4 text-center">
          <div class="text-2xl mb-1"><i class="fas fa-clipboard-list"></i></div>
          <h5 class="font-semibold">Upcoming Exams</h5>
          <h3 class="text-2xl font-bold">{{ upcoming_exams|length }}</h3>
          <small>Scheduled</small>
        </div>
        <div class="bg-cyan-600 text-white rounded p-4 text-center">
          <div class="text-2xl mb-1"><i class="fas fa-graduation-cap"></i></div>
          <h5 class="font-semibold">GPA</h5>
          <h3 class="text-2xl font-bold">
            {% if student.gpa %}
              {{ student.gpa }}
            {% else %}
              N/A
            {% endif %}
          </h3>
          <small>Current GPA</small>
        </div>
      </div>

      <!-- Recent Announcements -->
      {% if announcements %}
      <div class="mt-6">
        <h3 class="text-xl font-semibold mb-4">Recent Announcements</h3>
        <div class="space-y-3">
          {% for announcement in announcements %}
          <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <h4 class="font-semibold text-gray-900">{{ announcement.title }}</h4>
                <p class="text-gray-600 text-sm mt-1">{{ announcement.content|truncatechars:150 }}</p>
                <div class="flex items-center mt-2 text-xs text-gray-500">
                  <span class="badge bg-{% if announcement.priority == 'urgent' %}red-500{% elif announcement.priority == 'high' %}orange-500{% elif announcement.priority == 'medium' %}blue-500{% else %}gray-500{% endif %} text-white px-2 py-1 rounded">
                    {{ announcement.get_priority_display }}
                  </span>
                  <span class="ml-2">{{ announcement.publish_date|date:"M d, Y" }}</span>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Upcoming Assignments -->
      {% if upcoming_assignments %}
      <div class="mt-6">
        <h3 class="text-xl font-semibold mb-4">Upcoming Assignments</h3>
        <div class="space-y-3">
          {% for assignment in upcoming_assignments %}
          <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <h4 class="font-semibold text-gray-900">{{ assignment.title }}</h4>
                <p class="text-gray-600 text-sm mt-1">{{ assignment.course.code }} - {{ assignment.course.name }}</p>
                <div class="flex items-center mt-2 text-xs text-gray-500">
                  <i class="fas fa-clock mr-1"></i>
                  <span>Due: {{ assignment.due_date|date:"M d, Y H:i" }}</span>
                  <span class="ml-4">{{ assignment.max_points }} points</span>
                </div>
              </div>
              <div class="ml-4">
                <span class="badge bg-{% if assignment.due_date|date:'Y-m-d' < today %}red-500{% elif assignment.due_date|date:'Y-m-d' == today %}yellow-500{% else %}green-500{% endif %} text-white px-2 py-1 rounded">
                  {% if assignment.due_date|date:'Y-m-d' < today %}Overdue{% elif assignment.due_date|date:'Y-m-d' == today %}Due Today{% else %}Upcoming{% endif %}
                </span>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Upcoming Exams -->
      {% if upcoming_exams %}
      <div class="mt-6">
        <h3 class="text-xl font-semibold mb-4">Upcoming Exams</h3>
        <div class="space-y-3">
          {% for exam in upcoming_exams %}
          <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <h4 class="font-semibold text-gray-900">{{ exam.title }}</h4>
                <p class="text-gray-600 text-sm mt-1">{{ exam.course.code }} - {{ exam.course.name }}</p>
                <div class="flex items-center mt-2 text-xs text-gray-500">
                  <i class="fas fa-calendar mr-1"></i>
                  <span>{{ exam.exam_date|date:"M d, Y H:i" }}</span>
                  <span class="ml-4">{{ exam.duration_minutes }} minutes</span>
                  {% if exam.location %}
                  <span class="ml-4"><i class="fas fa-map-marker-alt mr-1"></i>{{ exam.location }}</span>
                  {% endif %}
                </div>
              </div>
              <div class="ml-4">
                <span class="badge bg-{% if exam.exam_type == 'final' %}red-500{% elif exam.exam_type == 'midterm' %}orange-500{% else %}blue-500{% endif %} text-white px-2 py-1 rounded">
                  {{ exam.get_exam_type_display }}
                </span>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Hidden sections to be toggled by sidebar (kept minimal) -->
    <div id="section-grades" class="hidden mt-6">
      <h3 class="text-xl font-semibold">My Grades</h3>
      <p class="text-gray-700">Check your latest grades and performance.</p>
    </div>
    <div id="section-assignments" class="hidden mt-6">
      <h3 class="text-xl font-semibold">Assignments</h3>
      <p class="text-gray-700">See upcoming and submitted assignments.</p>
    </div>
    <div id="section-profile" class="hidden mt-6">
      <h3 class="text-xl font-semibold">Profile</h3>
      <p class="text-gray-700">Update your personal information and settings.</p>
    </div>
    <div id="section-timetable" class="hidden mt-6">
      <h3 class="text-xl font-semibold">Timetable</h3>
      <p class="text-gray-700">View your daily and weekly class schedule.</p>
    </div>
    <div id="section-messages" class="hidden mt-6">
      <h3 class="text-xl font-semibold">Messages</h3>
      <p class="text-gray-700">Check messages from teachers and classmates.</p>
    </div>
    <div id="section-news" class="hidden mt-6">
      <h3 class="text-xl font-semibold">School News</h3>
      <p class="text-gray-700">Read the latest announcements and updates.</p>
    </div>
    <div id="section-library" class="hidden mt-6">
      <h3 class="text-xl font-semibold">Library</h3>
      <p class="text-gray-700">Access digital resources and library catalog.</p>
    </div>
    <div id="section-clubs" class="hidden mt-6">
      <h3 class="text-xl font-semibold">Clubs & Activities</h3>
      <p class="text-gray-700">Join and participate in school clubs and activities.</p>
    </div>
  </main>
</div>

{% endblock %} {% endif %}
